{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as ReservationActions from '../state/reservation.action';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/service/reservation.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@ngrx/store\";\nimport * as i5 from \"../../shared/wizard-step/wizard-step.component\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../capacity/capacity.component\";\nimport * as i8 from \"@ngx-translate/core\";\n\nfunction ReservationComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1, \" A selection is required \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ReservationComponent_div_6_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"label\", 14);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 15);\n    i0.ɵɵlistener(\"change\", function ReservationComponent_div_6_div_12_Template_input_change_4_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const j_r6 = restoredCtx.index;\n      const i_r3 = i0.ɵɵnextContext().index;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.changeReservation(i_r3 + 1, j_r6 + 1);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const j_r6 = ctx.index;\n    const i_r3 = i0.ɵɵnextContext().index;\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(j_r6 + 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"id\", \"numOfChilds_\" + (j_r6 + 1).toString() + \"_week_\" + (i_r3 + 1).toString())(\"value\", ctx_r4.createWeeklyReservation(i_r3 + 1, j_r6 + 1));\n  }\n}\n\nconst _c0 = function () {\n  return [];\n};\n\nfunction ReservationComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"div\", 8);\n    i0.ɵɵelementStart(2, \"div\", 9);\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"app-capacity\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 11);\n    i0.ɵɵelementStart(8, \"div\", 12);\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 13);\n    i0.ɵɵtemplate(12, ReservationComponent_div_6_div_12_Template, 5, 3, \"div\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(13, \"hr\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const i_r3 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate2(\"\", i0.ɵɵpipeBind1(5, 5, \"WEEKNR\"), \" \", i_r3 + 1, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"week\", i_r3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(10, 7, \"NUMBEROFRESERVATIONS\"), \": \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(9, _c0).constructor(ctx_r1.maxReservations));\n  }\n}\n\nexport let ReservationComponent = /*#__PURE__*/(() => {\n  class ReservationComponent {\n    constructor(fb, reservationService, router, store) {\n      this.fb = fb;\n      this.reservationService = reservationService;\n      this.router = router;\n      this.store = store;\n      this.title = 'RESERVATION';\n      this.maxWeeks = 1;\n      this.maxReservations = 1;\n      this.submitted = false;\n      this.signupForm = this.fb.group({\n        numOfChilds: [0, [Validators.required, Validators.min(1)]]\n      });\n      this.reservationsPerWeekCtlr = this.signupForm.get('numOfChilds');\n      this.maxWeeks = +process.env.MAX_NUMBER_OF_WEEKS;\n      this.maxReservations = +process.env.MAX_NUMBER_OF_RESERVATIONS;\n    }\n\n    createWeeklyReservation(week, reservations) {\n      return {\n        weekNr: week,\n        numberOfReservations: reservations\n      };\n    }\n\n    changeReservation(weekNumber, numberOfChildren) {\n      const weeklyReservation = {\n        weekNr: weekNumber,\n        numberOfReservations: numberOfChildren\n      };\n      this.store.dispatch(ReservationActions.setWeeklyReservation({\n        weeklyReservation\n      }));\n    }\n\n    goToNextStep() {\n      console.log(this.signupForm);\n      console.log('Saved: ' + JSON.stringify(this.signupForm.value));\n\n      if (this.signupForm.invalid) {\n        this.submitted = true;\n        return;\n      }\n\n      const weeklyReservationControl = this.signupForm.get('numOfChilds');\n\n      if (weeklyReservationControl) {\n        let weeklyReservation = weeklyReservationControl === null || weeklyReservationControl === void 0 ? void 0 : weeklyReservationControl.value;\n        let deadlineMs = (5 + weeklyReservation.numberOfReservations * 3) * 60 * 1000;\n        let deadline = new Date(new Date().getTime() + deadlineMs);\n        let param = {\n          subscriptionInsertInput: {\n            deadline,\n            numOfChildren: weeklyReservation.numberOfReservations,\n            reservationDate: new Date(),\n            state: 'temporary',\n            week: weeklyReservation.weekNr\n          }\n        };\n        this.reservationSubscription = this.reservationService.createWeeklyReservation(param).subscribe(inscriptionId => {\n          this.store.dispatch(ReservationActions.setDeadline({\n            deadline\n          }));\n          this.router.navigate(['/inscriptions/inscription', inscriptionId]).then(x => {\n            this.reservationSubscription.unsubscribe();\n          });\n        });\n      }\n    }\n\n    goToPreviousStep() {\n      this.router.navigate(['welcome']).then(x => {\n        this.reservationSubscription.unsubscribe();\n      });\n    }\n\n    ngOnDestroy() {\n      this.reservationSubscription.unsubscribe();\n    }\n\n  }\n\n  ReservationComponent.ɵfac = function ReservationComponent_Factory(t) {\n    return new (t || ReservationComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ReservationService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.Store));\n  };\n\n  ReservationComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ReservationComponent,\n    selectors: [[\"app-reservation\"]],\n    decls: 7,\n    vars: 5,\n    consts: [[3, \"title\", \"previousStepClicked\", \"nextStepClicked\"], [1, \"wizard-content\"], [1, \"wizard-content-body\"], [3, \"formGroup\"], [1, \"form-group\", \"row\", \"mb-2\"], [\"class\", \"alert alert-danger fade show\", \"role\", \"alert\", 4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", \"fade\", \"show\"], [1, \"weekBlock\"], [1, \"weekSituation\"], [3, \"week\"], [1, \"weekReservation\"], [1, \"radio-header\", \"text-warning\"], [1, \"radio-container\"], [1, \"form-check-label\"], [\"type\", \"radio\", \"formControlName\", \"numOfChilds\", 1, \"form-check-input\", 3, \"id\", \"value\", \"change\"]],\n    template: function ReservationComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"app-wizard-step\", 0);\n        i0.ɵɵlistener(\"previousStepClicked\", function ReservationComponent_Template_app_wizard_step_previousStepClicked_0_listener() {\n          return ctx.goToPreviousStep();\n        })(\"nextStepClicked\", function ReservationComponent_Template_app_wizard_step_nextStepClicked_0_listener() {\n          return ctx.goToNextStep();\n        });\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"form\", 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵtemplate(5, ReservationComponent_div_5_Template, 2, 0, \"div\", 5);\n        i0.ɵɵtemplate(6, ReservationComponent_div_6_Template, 14, 10, \"div\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"title\", ctx.title);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.signupForm);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.submitted && (ctx.reservationsPerWeekCtlr == null ? null : ctx.reservationsPerWeekCtlr.errors == null ? null : ctx.reservationsPerWeekCtlr.errors.min));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(4, _c0).constructor(ctx.maxWeeks));\n      }\n    },\n    directives: [i5.WizardStepComponent, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i6.NgIf, i6.NgForOf, i7.CapacityComponent, i1.RadioControlValueAccessor, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName],\n    pipes: [i8.TranslatePipe],\n    styles: [\".radio-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap}.alert[_ngcontent-%COMP%]{padding:.1rem 0rem;margin:.2rem 0rem;text-align:center}.weekBlock[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-between;margin-left:.8rem}.weekSituation[_ngcontent-%COMP%]{padding-right:2rem}.weekReservation[_ngcontent-%COMP%]{font-size:1.2rem;display:flex;flex-wrap:wrap;padding:10px 0 5px}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-around;padding-right:1rem;text-align:center}label[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{padding-left:unset!important}label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;font-size:1.2rem;width:100%}\"]\n  });\n  return ReservationComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}